<template>	
<div class="portlet light ">
        <div class="portlet-body">
        <filter-tools 
                :data.sync="data"
                :keyword.sync="keyword"
            >
            </filter-tools>
            <div class="table-scrollable table-scrollable-borderless">
                <div v-if="$loadingAsyncData" class="move-top-10"><loading></loading></div>
<table v-else class="table-striped table-checkable table table-hover table-bordered admin">
    <thead>
        <tr class="uppercase">
        <th><input type="checkbox" v-model="checkAll"></th>
            <th colspan="2"> MEMBER </th>
            <th colspan="2"> Ticket total bought </th>
            <th> DEPOSIT Total </th>
            <th> WITHDRAW/CLAIM Total </th>
            <th> Blance </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr v-for="user in data.data" :class="[$index % 2 == 0 ? 'odd' : 'even']">
        <td><input type="checkbox" :value="user.id"></td>
            <td class="fit">
                <img class="user-pic" :src="user.image" width="30px"> </td>
            <td>
                <a href="javascript:;" class="primary-link">{{user.fullname}}</a>
            </td>
            <td> {{user.ticket_total}} </td>
            <td> {{user.price_total | currency}} </td>
            <td class="font-blue-madison"> +{{user.deposit_total | currency}} </td>
            <td class="font-red-mint"> -{{user.withdraw_total | currency}} </td>
            <td>
                <span class="bold theme-font">{{user.balance | currency}}</span>
            </td>
            <td><a href="" style="color: #f60000"><i class="fa fa-trash"></i></a></td>
        </tr>
    </tbody>
</table>
</div>
</div>
</div>
</template>

<script>
import laroute from '../../../laroute';
import COMMON from '../../../common';
import deferred from 'deferred';
import FilterTools from '../Order/FilterTools.vue';

export default {
    data() {
            return {
                api: laroute.route('admin.get.users'),
                data: {
                    per_page: "10",
                },
                keyword: '',
                ids: [],
                checkAll: false,
            }
        },

        asyncData(resolve, reject) {
            console.log(this.keyword)
            this._fetchUsers(this.api).done(data => {
                resolve({ data });
            }, err => {
                COMMON.alertError();
                console.warn(err);
            });
        },

         watch: {
            timeForReload: 'reloadAsyncData',
            'data.per_page'(val, old) {
                (val && old) && this.reloadAsyncData();
            },
        },

        computed: {
            timeForReload() {
            return Math.random(this.keyword);
            },
        },
   
        methods: {
            _fetchUsers(api, take = this.data.per_page, keyword = this.keyword) {
                const def = deferred();
                this.$http.get(api, { take, keyword }).then(res => {
                    const { data } = res;
                    def.resolve(data);
                }, res => {
                    def.reject(res);
                });
                return  def.promise;
            },
            nextPagination() {
                this._fetchUser(this.nextPageUrl).done(users => {
                    this.users = this.users.concat(users);
                }, err => {
                    COMMON.alertError();
                });
            }
        },

        events: {
            'go-to-page'(api) {
                this.api = api;
                this.reloadAsyncData();
            }
        },

        components: {  FilterTools }
}
</script>